;; msg -> pk
int parseSMT(slice msg) {
  var signature = msg~load_bits(512);
  var signedCell = msg~load_ref();
  var signedS = signedCell.begin_parse();
  var (pk, wc, addr) = (signedS~load_pk(), signedS~load_int(8), signedS~load_uint(256));

  var (myWc, myAddr) = parse_std_addr(my_address());

  throw_unless_(STM::BadSignature(), check_signature(cell_hash(signedCell), signature, pk));
  throw_unless_(STM::AddressMismatch(), (myWc == wc) & (myAddr == addr));

  return pk;
}